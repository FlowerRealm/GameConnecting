# GameConnecting 项目详细介绍

## 项目背景

GameConnecting是一个专为游戏玩家设计的实时社交平台，旨在解决游戏玩家在寻找队友、组织游戏活动和管理游戏社区时遇到的问题。

### 项目目标
- 提供简单易用的游戏社交平台
- 支持实时聊天和语音通信
- 实现灵活的房间和组织管理
- 确保用户数据安全和隐私保护

## 功能模块详解

### 1. 用户认证系统

#### 用户名注册机制
- **特点**: 无需邮箱，仅需用户名和密码
- **安全性**: 后端自动生成占位邮箱，避免真实邮箱泄露
- **流程**:
  1. 用户提交用户名和密码
  2. 后端规范化用户名并生成唯一占位邮箱
  3. 通过Supabase Admin API创建认证用户
  4. 创建用户资料记录，状态设为pending
  5. 等待管理员审批

#### 管理员审批系统
- **目的**: 确保用户质量，防止恶意注册
- **流程**:
  1. 管理员查看待审批用户列表
  2. 审核用户信息
  3. 批准或拒绝用户注册
  4. 用户状态更新为active或banned

#### 密码重置功能
- **安全性**: 6位数字重置码，1小时有效期
- **流程**:
  1. 用户请求密码重置
  2. 系统生成重置码并发送（开发环境显示在控制台）
  3. 用户输入重置码验证
  4. 验证成功后设置新密码

### 2. 房间管理系统

#### 房间创建
- **权限**: 所有认证用户可创建房间
- **信息**: 房间名称、描述、类型（公开/私有）
- **所有者**: 创建者自动成为房间所有者

#### 房间加入
- **公开房间**: 任何用户可直接加入
- **私有房间**: 需要发送加入申请（功能待实现）
- **成员管理**: 所有者和管理员可管理成员

#### 房间操作
- **编辑**: 所有者可修改房间信息
- **删除**: 所有者可删除房间（级联删除成员）
- **踢出**: 所有者和管理员可踢出成员

### 3. 组织管理系统

#### 组织创建
- **权限**: 管理员可创建组织
- **信息**: 组织名称、描述、可见性设置

#### 成员管理
- **角色**: 成员、组织管理员
- **状态**: 待审批、已批准、已拒绝、已离开
- **权限**: 组织管理员可管理成员

#### 组织功能
- **公开列表**: 可设置组织是否在公开列表中显示
- **成员邀请**: 管理员可邀请用户加入组织
- **成员审批**: 管理员可审批成员申请

### 4. 实时聊天系统

#### Socket.IO集成
- **连接**: 客户端通过Socket.IO连接服务器
- **认证**: 连接时发送JWT令牌验证身份
- **房间**: 用户可加入多个聊天房间

#### 消息处理
- **实时发送**: 消息实时发送给房间内所有成员
- **消息类型**: 文本消息、系统消息
- **消息存储**: 消息存储在数据库中（功能待实现）

#### 在线状态
- **用户状态**: 显示用户在线/离线状态
- **房间状态**: 显示房间内在线用户数量
- **状态更新**: 实时更新用户状态

### 5. 管理员功能

#### 用户管理
- **用户列表**: 查看所有用户，支持分页
- **用户状态**: 修改用户状态（active/suspended/banned）
- **用户角色**: 修改用户角色（user/admin/moderator）
- **用户删除**: 删除用户账户

#### 服务器管理
- **服务器列表**: 查看所有房间/服务器
- **服务器信息**: 查看服务器详细信息
- **成员管理**: 管理服务器成员
- **服务器操作**: 编辑、删除服务器

#### 组织管理
- **组织列表**: 查看所有组织
- **组织创建**: 创建新组织
- **成员审批**: 审批组织成员申请
- **组织操作**: 编辑、删除组织

## 技术实现细节

### 后端架构

#### 分层架构
```
┌─────────────────┐
│   API Routes    │  ← 路由层：处理HTTP请求
├─────────────────┤
│   Middleware    │  ← 中间件层：认证、验证、日志
├─────────────────┤
│   Services      │  ← 服务层：业务逻辑
├─────────────────┤
│   Database      │  ← 数据层：Supabase/PostgreSQL
└─────────────────┘
```

#### 核心服务
- **AuthService**: 用户认证、注册、密码重置
- **RoomService**: 房间创建、管理、成员操作
- **AdminOrganizationService**: 组织管理
- **UserService**: 用户信息管理

#### 中间件
- **authenticateToken**: JWT令牌验证
- **isAdmin**: 管理员权限检查
- **verifyApiKey**: API密钥验证

### 前端架构

#### 模块化设计
```
┌─────────────────┐
│   Pages         │  ← 页面组件
├─────────────────┤
│   Components    │  ← 可复用组件
├─────────────────┤
│   Services      │  ← 服务层
├─────────────────┤
│   Utils         │  ← 工具函数
└─────────────────┘
```

#### 核心模块
- **AuthManager**: 认证状态管理
- **ApiService**: API通信服务
- **Store**: 状态管理
- **SocketManager**: Socket.IO连接管理

#### 页面结构
- **登录/注册**: 用户认证页面
- **服务器列表**: 房间管理页面
- **聊天页面**: 实时聊天界面
- **管理员页面**: 管理功能界面
- **用户资料**: 个人信息管理

### 数据库设计

#### 表关系图
```
user_profiles (用户资料)
    ↓
user_organization_memberships (用户组织关系)
    ↓
organizations (组织)
    ↓
rooms (房间)
    ↓
room_members (房间成员)
    ↓
password_reset_requests (密码重置)
```

#### 关键约束
- 用户名唯一性约束
- 房间成员唯一性约束
- 组织成员唯一性约束
- 外键级联删除

## 安全机制

### 认证安全
- **JWT令牌**: 短期访问令牌 + 长期刷新令牌
- **占位邮箱**: 避免真实邮箱泄露
- **密码哈希**: Supabase自动处理密码安全
- **状态验证**: 登录前检查用户状态

### 数据安全
- **SQL注入防护**: 参数化查询
- **XSS防护**: 输入验证和输出编码
- **CSRF防护**: 令牌验证
- **权限控制**: 基于角色的访问控制

### 网络安全
- **HTTPS**: 生产环境强制HTTPS
- **CORS**: 限制跨域请求
- **API密钥**: 后端服务认证
- **请求限流**: 防止暴力攻击

## 性能优化

### 后端优化
- **内存缓存**: 用户资料查询缓存
- **数据库索引**: 关键字段索引优化
- **连接池**: 数据库连接复用
- **压缩中间件**: 响应数据压缩
- **集群模式**: 多进程负载均衡

### 前端优化
- **请求缓存**: API响应缓存
- **防抖处理**: 避免重复请求
- **懒加载**: 按需加载组件
- **内存管理**: 及时清理事件监听器
- **CDN加速**: 静态资源CDN分发

## 部署架构

### 开发环境
- **前端**: localhost:12000
- **后端**: localhost:12001
- **数据库**: 本地PostgreSQL

### 生产环境
- **前端**: Vercel部署
- **后端**: Render部署
- **数据库**: Supabase托管

### 环境配置
- **开发**: `.env.development`
- **生产**: `.env.production`
- **构建**: 自动生成配置文件

## 监控和日志

### 性能监控
- **响应时间**: 记录慢请求（>300ms）
- **错误率**: 统计API错误
- **资源使用**: 内存和CPU监控
- **数据库性能**: 查询时间统计

### 日志记录
- **访问日志**: 请求记录
- **错误日志**: 异常记录
- **安全日志**: 认证和授权记录
- **业务日志**: 关键操作记录

## 扩展性设计

### 水平扩展
- **无状态设计**: 支持多实例部署
- **数据库分离**: 读写分离支持
- **缓存层**: Redis缓存支持
- **负载均衡**: 多实例负载均衡

### 功能扩展
- **插件系统**: 支持功能插件
- **API版本**: 支持API版本管理
- **配置管理**: 支持动态配置
- **国际化**: 多语言支持

## 未来规划

### 短期目标
- 完善实时聊天功能
- 添加语音聊天支持
- 实现文件上传功能
- 优化移动端体验

### 长期目标
- 支持游戏集成
- 添加数据分析功能
- 实现高级权限系统
- 支持第三方登录

---

*本文档最后更新时间: 2025年1月*