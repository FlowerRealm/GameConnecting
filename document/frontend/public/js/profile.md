# 前端用户资料脚本 (`profile.js`)

该文件是前端用户资料页面的核心 JavaScript 逻辑，负责处理用户密码修改和显示用户所属组织的功能。它确保用户在访问此页面时已认证，并与后端 API 交互以获取和更新数据。

## 依赖

-   `./auth.js`: `AuthManager` 实例，用于用户认证和密码修改。
-   `./navbar.js`: `initNavbar` 函数，用于初始化导航栏。
-   `./apiService.js`: `apiService` 实例，用于向后端发送 API 请求。

## 主要功能

### 1. 认证与初始化

-   页面加载时，检查用户是否已通过 `AuthManager.isAuthenticated()` 认证。如果未认证，则重定向到登录页面。
-   初始化导航栏 (`initNavbar()`)。
-   如果用户已认证，则调用 `loadMyOrganizations()` 加载并显示用户所属组织。

### 2. 密码修改功能

-   **表单元素**: 获取 `change-password-form`、`new-password`、`confirm-password` 和 `message-area`。
-   **事件监听**: 监听 `change-password-form` 的 `submit` 事件。
-   **逻辑**:
    1.  阻止表单的默认提交行为。
    2.  获取用户输入的新密码和确认密码。
    3.  **客户端验证**:
        -   检查新密码和确认密码是否为空。
        -   检查新密码长度是否至少为6位。
        -   检查两次输入的密码是否匹配。
        -   如果验证失败，则在 `messageArea` 显示错误消息。
    4.  **调用密码修改服务**: 调用 `authManager.changePassword(newPassword)` 向后端发送密码修改请求。
    5.  **处理结果**:
        -   如果成功，显示“密码更新成功！”消息，并清空表单。
        -   如果失败，显示后端返回的错误消息或通用错误消息。
        -   捕获网络错误或其他异常，显示通用错误消息。

### 3. 显示用户组织

-   `loadMyOrganizations()`: 
    -   **描述**: 从后端 API (`/users/me/organizations`) 获取当前用户所属的组织列表。
    -   **逻辑**:
        1.  获取 `organizations-list-container` 元素。
        2.  向后端发送 GET 请求。
        3.  如果成功且返回数据是数组，则遍历数据并为每个组织生成 HTML，显示组织名称、用户角色和成员状态。
        4.  如果用户未加入任何组织，则显示“您尚未加入任何组织。”的消息。
        5.  如果请求失败，则在容器中显示错误消息。

## 交互流程

-   用户访问个人资料页面，系统首先验证其认证状态。
-   页面加载时，自动显示用户所属的组织列表。
-   用户可以在“更改密码”部分输入新密码并确认，然后提交表单以更新密码。
-   系统会根据操作结果在页面上显示相应的成功或错误消息。

## 维护

该文档应与 `frontend/public/js/profile.js` 文件的任何更改保持同步，以确保其准确性和实用性。
