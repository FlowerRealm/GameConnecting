# 前端注册脚本 (`register.js`)

该文件是前端注册页面的核心 JavaScript 逻辑，负责处理用户注册请求、加载可选的组织列表、验证输入数据，并根据注册结果进行页面重定向。

## 依赖

-   `./auth.js`: `AuthManager` 实例，用于处理用户注册逻辑。
-   `./navbar.js`: `initNavbar` 函数，用于初始化导航栏。
-   `./apiService.js`: `apiService` 实例，用于向后端发送 API 请求，特别是获取组织列表。

## 主要功能

### 1. 自动重定向

-   页面加载时，如果用户已经通过 `AuthManager.isAuthenticated()` 认证，则直接重定向到主页 (`/`)。

### 2. 导航栏初始化

-   调用 `initNavbar()` 初始化页面导航栏。

### 3. 加载和渲染组织列表

-   `loadAndRenderOrganizations()`: 
    -   **描述**: 从后端 API (`/api/organizations`) 获取公开组织列表，并将其渲染为可供用户选择的复选框。
    -   **逻辑**:
        1.  获取 `organization-select-container` 元素。
        2.  向后端发送 GET 请求以获取组织列表。
        3.  如果成功，遍历返回的组织数据，为每个组织创建复选框和标签，并添加到容器中。
        4.  如果组织列表为空，显示“暂无公开组织可供选择加入。”的消息。
        5.  如果请求失败，显示错误消息。

### 4. 注册表单处理

-   **表单元素**: 获取 `register-form` 和 `error` 消息显示元素。
-   **事件监听**: 监听表单的 `submit` 事件。
-   **逻辑**:
    1.  阻止表单的默认提交行为。
    2.  获取用户输入的用户名 (`username`)、密码 (`password`)、确认密码 (`confirmPassword`) 和备注 (`note`)。
    3.  清空并隐藏之前的错误消息。
    4.  **客户端验证**:
        -   检查用户名是否为空，长度是否在 3-20 个字符之间。
        -   检查密码是否为空，长度是否至少为 6 个字符。
        -   检查两次输入的密码是否一致。
        -   检查备注长度是否超过 500 个字符。
        -   如果验证失败，则显示相应的错误消息并返回。
    5.  **获取选中的组织**: 收集用户选择的组织 ID。
    6.  **调用注册服务**: 调用 `auth.register()` 向后端发送注册请求，请求体包含 `username`, `password`, `note` 和 `requestedOrganizationIds`。
    7.  **处理注册结果**:
        -   如果 `result.success` 为 `true`，则显示“注册成功，正在跳转到登录页面...”的消息，并在 1.5 秒后重定向到登录页面 (`/login`)。
        -   如果 `result.success` 为 `false`，则显示后端返回的错误消息或通用错误消息。
        -   捕获网络错误或其他异常，显示“网络错误，请稍后重试”的消息。

## 交互流程

1.  用户访问注册页面。
2.  如果用户已登录，则自动重定向。
3.  页面加载时，自动加载并显示可供选择的公开组织列表。
4.  用户填写注册表单，包括用户名、密码、确认密码、备注和可选的组织选择。
5.  用户点击“注册”按钮。
6.  前端进行客户端验证。
7.  向后端发送注册请求。
8.  根据后端响应，显示成功/失败消息，并进行页面跳转。

## 维护

该文档应与 `frontend/public/js/register.js` 文件的任何更改保持同步，以确保其准确性和实用性。
